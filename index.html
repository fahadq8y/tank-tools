<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PBCR & WASHERY</title>
<link href="icon.png" rel="icon" type="image/png"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),url('background.jpg');background-size:cover;background-position:center;background-attachment:fixed;color:white;font-family:Arial,sans-serif;padding:20px;min-height:100vh}
.nav-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:rgba(0,0,0,0.5);border-radius:10px;margin-bottom:20px;flex-wrap:wrap}
.nav-logo{font-size:24px;font-weight:bold;color:white}
.nav-links{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.nav-link{color:white;text-decoration:none;padding:8px 16px;border-radius:8px;transition:all 0.3s ease;background:rgba(255,255,255,0.1);font-weight:500;border:1px solid rgba(255,255,255,0.2)}
.nav-link:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px)}
.nav-link.active{background:rgba(255,255,255,0.3);font-weight:bold;border:1px solid rgba(255,255,255,0.4)}
.nav-admin{background:linear-gradient(45deg,#FFD700,#FFA500);color:#003366;font-weight:bold;border-radius:8px;padding:8px 16px;text-decoration:none;transition:all 0.3s ease;border:1px solid #FFA500;font-size:inherit}
.nav-user{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.1);padding:5px 15px;border-radius:20px}
.user-avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(45deg,#4CAF50,#45a049);display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px}
.logout-btn{background:rgba(255,0,0,0.2);border:1px solid rgba(255,0,0,0.5);color:white;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px}
.font-controls{display:flex;gap:5px;margin-right:10px}
.font-btn{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;padding:8px 12px;border-radius:5px;cursor:pointer;font-size:18px;font-weight:bold;transition:all 0.3s ease;width:40px;height:40px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(255,255,255,0.2)}
.font-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-1px);box-shadow:0 4px 8px rgba(255,255,255,0.3)}
input,select{background:rgba(255,255,255,0.9);border-radius:12px;border:none;color:#003366;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:16px;margin:10px;padding:10px;width:250px;text-align:center}
.row{display:flex;justify-content:center;align-items:center;gap:8px;margin:10px 0;max-width:400px;margin-left:auto;margin-right:auto}
.row input,.row select{margin:0;flex:1;width:50%}
.result{margin-top:10px;font-weight:bold;color:#00ffff;text-align:center}
#tankTable{margin:auto;background:rgba(255,255,255,0.85);color:#003366;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;min-width:300px}
#tankTable th{padding:10px;border-bottom:1px solid #003366}
.buttons-section{margin:20px 0;padding:15px;background:rgba(255,255,255,0.1);border-radius:15px;backdrop-filter:blur(10px)}
.button-row{display:flex;align-items:center;justify-content:center;gap:10px;margin:8px 0}
.action-btn{padding:12px 24px;font-size:14px;font-weight:600;border:none;border-radius:10px;cursor:pointer;transition:all 0.3s ease;display:inline-flex;align-items:center;gap:8px;width:180px;height:45px;justify-content:center}
.live-tanks-btn{background:linear-gradient(45deg,#ff4444,#ff6666);color:white;box-shadow:0 2px 8px rgba(255,68,68,0.3)}
.reminder-btn{background:linear-gradient(45deg,#4CAF50,#45a049);color:white;box-shadow:0 2px 8px rgba(76,175,80,0.3)}
.table-btn{background:linear-gradient(45deg,#2196F3,#1976D2);color:white;box-shadow:0 2px 8px rgba(33,150,243,0.3)}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.help-btn{background:linear-gradient(45deg,#FF9800,#F57C00);color:white;border:none;border-radius:50%;cursor:pointer;font-size:14px;transition:all 0.3s ease;display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;box-shadow:0 2px 6px rgba(255,152,0,0.3)}
.help-btn:hover{transform:translateY(-2px) scale(1.1);box-shadow:0 4px 10px rgba(255,152,0,0.4)}
.buttons-container{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;align-items:center;margin-top:15px}
.action-button{position:fixed;width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.3);border:none;font-size:20px;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;top:10px;right:10px}
.access-denied{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.8)),url('background.jpg');background-size:cover;background-position:center;display:flex;justify-content:center;align-items:center;z-index:9999}
.access-denied-content{text-align:center;background:rgba(255,255,255,0.1);padding:40px;border-radius:20px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2)}
.access-denied-icon{font-size:5rem;color:#f44336;margin-bottom:20px}
.access-denied-title{font-size:2rem;color:#f44336;margin-bottom:15px}
.access-denied-text{font-size:1.2rem;margin-bottom:20px;opacity:0.8}
.login-btn{padding:12px 25px;background:linear-gradient(45deg,#4CAF50,#45a049);color:white;border:none;border-radius:10px;cursor:pointer;font-size:16px}
.lt-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;backdrop-filter:blur(5px)}
.lt-modal.show{display:flex;justify-content:center;align-items:center}
.lt-modal-content{background:rgba(255,255,255,0.95);padding:30px;border-radius:15px;max-width:500px;width:90%;color:#003366}
.close-btn{background:none;border:none;font-size:28px;cursor:pointer;color:#666;font-weight:bold;float:right}
.form-group{margin-bottom:20px}
.form-label{display:block;margin-bottom:8px;font-weight:600;color:#003366}
.form-input,.form-select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:14px}
.form-textarea{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:14px;min-height:80px}
.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;display:inline-flex;align-items:center;gap:8px}
.btn-primary{background:linear-gradient(45deg,#4CAF50,#45a049);color:white}
.btn-secondary{background:linear-gradient(45deg,#6c757d,#5a6268);color:white}
.modal-buttons{display:flex;gap:15px;justify-content:flex-end;margin-top:25px}
.footer{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);padding:10px 20px;text-align:center;border-top:1px solid rgba(255,255,255,0.1)}
.footer-content{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;flex-wrap:wrap;gap:10px}
.footer-left{color:#25D366;font-weight:600;transition:all 0.3s ease}
.footer-left:hover{color:#128C7E;text-shadow:0 0 10px rgba(37,211,102,0.5)}
.footer-right{color:#888;font-size:14px}
.footer a{color:#25D366;text-decoration:none;transition:all 0.3s ease}
.footer a:hover{color:#128C7E;text-shadow:0 0 10px rgba(37,211,102,0.5)}
@media (max-width:600px){input,select{width:90%!important}.row{max-width:350px}.nav-bar{flex-direction:column;gap:15px;padding:15px}.buttons-container{flex-direction:column}.live-tanks-btn{width:90%}.footer-content{flex-direction:column;text-align:center;gap:5px}}
</style>
</head>
<body>
<div id="accessDenied" class="access-denied" style="display:none">
<div class="access-denied-content">
<div class="access-denied-icon">üîí</div>
<div class="access-denied-title">Login Required</div>
<div class="access-denied-text">You need to login to access PBCR & WASHERY application.</div>
<button class="login-btn" onclick="goToLogin()">Go to Login</button>
</div>
</div>
<div id="mainContent">
<div class="nav-bar">
<div class="nav-logo">Tank Tools</div>
<div class="nav-links">
<a class="nav-link active" href="index.html">PBCR</a>
<a class="nav-link" href="plcr.html">PLCR</a>
<a class="nav-link" href="NMOGASBL.html">NMOGAS</a>
<a class="nav-link" href="live-tanks.html" id="liveTanksLink" style="display:none">üî¥ Live Tanks</a>
<a class="nav-admin" href="dashboard.html" id="adminLink" style="display:none">üîê Dashboard</a>
</div>
<div class="nav-user">
<div class="font-controls">
<button class="font-btn" onclick="decreaseFontSize()" title="ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿÆÿ∑">-</button>
<button class="font-btn" onclick="increaseFontSize()" title="ÿ™ŸÉÿ®Ÿäÿ± ÿßŸÑÿÆÿ∑">+</button>
</div>
<div class="user-avatar" id="userAvatar">U</div>
<div id="userName">User</div>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>
</div>
<h2 style="text-align:center">PBCR & WASHERY</h2>
<div style="text-align:center;padding:20px">
<input id="tankInput" oninput="loadTank()" placeholder="Enter Tank Number" type="number"/>
<input id="level" oninput="calculate()" placeholder="Current Level (m)" type="number"/>
<div class="result" id="availablePumpable"></div>
<div class="result" id="currentUllage"></div>
<div class="row">
<input id="target" oninput="calculate()" placeholder="Target Value" type="number"/>
<select id="mode" onchange="calculate()">
<option value="pumpable">Pumpable</option>
<option value="ullage">Ullage</option>
<option value="level">Level</option>
</select>
</div>
<div class="result" id="valueDiff"></div>
<div class="result" id="levelEstimate"></div>
<div class="row">
<input id="flowrate" oninput="calculate()" placeholder="Flowrate" type="number"/>
<select id="flowUnit" onchange="calculate()">
<option value="bbl">bbl/hr</option>
<option value="m3">m¬≥/hr</option>
<option value="mtr">meter/hr</option>
</select>
</div>
<div class="result" id="output"></div>
<div class="buttons-section">
<div class="button-row">
<button onclick="openLTModal()" class="action-btn live-tanks-btn" id="liveTanksBtn" style="display:none">üî¥ Add to Live Tanks</button>
<button onclick="showLiveTanksHelp()" class="help-btn" title="About Live Tanks">‚ÑπÔ∏è</button>
</div>
<div class="button-row">
<a href="#" id="calendarLink" target="_blank">
<button class="action-btn reminder-btn">üìÖ Add Reminder</button>
</a>
<button onclick="showCalendarHelp()" class="help-btn" title="How to use Calendar Reminder">‚ÑπÔ∏è</button>
</div>
<div class="button-row">
<button onclick="addToTable()" class="action-btn table-btn">üìä Add to Table</button>
<button onclick="showTableHelp()" class="help-btn" title="About Personal Table">‚ÑπÔ∏è</button>
</div>
</div>
<h3 style="margin-top:40px">Your tanks finishing in current shift:</h3>
<table id="tankTable">
<thead><tr><th>Tank Number</th><th>Finish Date</th><th>Finish Time</th><th>Delete</th></tr></thead>
<tbody></tbody>
</table>
</div>
<button id="darkModeButton" class="action-button" title="Dark Mode">üåô</button>
</div>
<div id="ltModal" class="lt-modal">
<div class="lt-modal-content">
<button class="close-btn" onclick="closeLTModal()">&times;</button>
<h3>üî¥ Add to Live Tanks</h3>
<form id="ltForm">
<div class="form-group">
<label class="form-label">üè≠ Department:</label>
<select class="form-select" id="ltDept" onchange="updateLTProducts()" required>
<option value="">Select Department</option>
<option value="PBCR">PBCR</option>
<option value="WASHERY">WASHERY</option>
<option value="PLCR">PLCR</option>
</select>
</div>
<div class="form-group">
<label class="form-label">üè∑Ô∏è Tank Number:</label>
<input type="text" class="form-input" id="ltTank" readonly style="background:#f5f5f5">
</div>
<div class="form-group">
<label class="form-label">üõ¢Ô∏è Product Type:</label>
<select class="form-select" id="ltProduct" required>
<option value="">Select Product</option>
</select>
</div>
<div class="form-group">
<label class="form-label">üìÖ Finish Date:</label>
<input type="text" class="form-input" id="ltDate" readonly style="background:#f5f5f5">
</div>
<div class="form-group">
<label class="form-label">‚è∞ Finish Time:</label>
<input type="text" class="form-input" id="ltTime" readonly style="background:#f5f5f5">
</div>
<div class="form-group">
<label class="form-label">üìù Notes (Optional):</label>
<textarea class="form-textarea" id="ltNotes" placeholder="Additional information..."></textarea>
</div>
<div class="modal-buttons">
<button type="button" class="btn btn-secondary" onclick="closeLTModal()">‚ùå Cancel</button>
<button type="submit" class="btn btn-primary">üíæ Add to Live Tanks</button>
</div>
</form>
</div>
</div>
<div class="footer">
<div class="footer-content">
<div class="footer-left">
<a href="https://wa.me/96555222550" target="_blank">Fahad - 17877 | WhatsApp: +965 55222550</a>
</div>
<div class="footer-right">Tank Tools v4.1</div>
</div>
</div>
<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
const app=initializeApp({apiKey:"AIzaSyD7lJcoY33FEC9d6eWy67QIO9SV4lS24pg",authDomain:"tank-tools-knpc-c2d95.firebaseapp.com",projectId:"tank-tools-knpc-c2d95",storageBucket:"tank-tools-knpc-c2d95.firebasestorage.app",messagingSenderId:"510062594324",appId:"1:510062594324:web:b892fd02007a5ca2f0da01"});
window.db=getFirestore(app);window.doc=doc;window.getDoc=getDoc;window.setDoc=setDoc;window.addDoc=addDoc;window.serverTimestamp=serverTimestamp;window.collection=collection;
</script>
<script>
let currentUser=null,c=0,m=0,x=0,calcData=null;
const tanks={"225":{comment:12879,min:3.353,max:15.24},"226":{comment:12879,min:3.353,max:15.24},"227":{comment:11327,min:2,max:17.95},"253":{comment:10781,min:2,max:17.093},"254":{comment:12288,min:2,max:14.96},"255":{comment:12287,min:2,max:14.96},"256":{comment:12287,min:2,max:14.96},"260":{comment:2249,min:2,max:13},"272":{comment:7217,min:2,max:15.309},"273":{comment:4198,min:2,max:13.468},"274":{comment:4198,min:2,max:13.458},"275":{comment:9563,min:2,max:17.897},"276":{comment:7236,min:2,max:15.442},"277":{comment:4188,min:2,max:13.714},"278":{comment:9506,min:1.98,max:17.89},"279":{comment:4118,min:1.98,max:15.977},"301":{comment:7756,min:3.048,max:18.54},"302":{comment:7756,min:3.048,max:18.54},"303":{comment:6070,min:2.59,max:14.173},"304":{comment:6070,min:2.59,max:14.173},"305":{comment:7171,min:0.533,max:18.797},"450":{comment:3155,min:2,max:14.2},"451":{comment:930,min:2,max:13},"452":{comment:4587,min:2,max:13},"453":{comment:5067,min:2,max:17.8},"454":{comment:1653,min:2,max:11.36},"455":{comment:1654,min:2,max:11.36},"456":{comment:11574,min:2.68,max:13.41},"457":{comment:9697,min:5.4,max:16.45},"458":{comment:9697,min:5.4,max:16.45},"459":{comment:9466,min:2,max:14.35},"460":{comment:14213,min:2,max:17.65},"461":{comment:14213,min:2,max:17.653},"462":{comment:12354,min:2,max:16.46},"463":{comment:9578,min:2,max:17.89},"464":{comment:9578,min:2,max:17.889},"465":{comment:9572,min:2,max:17.89},"467":{comment:12375,min:2,max:17.771},"468":{comment:12375,min:2,max:17.771},"469":{comment:12375,min:2,max:17.771},"470":{comment:12375,min:2,max:17.77},"503":{comment:2888,min:2.13,max:10.97},"504":{comment:2888,min:2.13,max:10.97},"506":{comment:930,min:0.92,max:14.33},"507":{comment:413,min:2,max:6.5},"508":{comment:1130,min:1.67,max:12.65},"509":{comment:1130,min:1.67,max:12.65},"510":{comment:529,min:2,max:10.363},"511":{comment:4531,min:0.198,max:9},"512":{comment:2939,min:0.92,max:11.6},"514":{comment:2942,min:0.92,max:12},"515":{comment:2942,min:0.92,max:12},"520":{comment:4142,min:1.88,max:14.29},"521":{comment:4142,min:1.88,max:14.29},"522":{comment:11990,min:1.61,max:15.6},"531":{comment:12377,min:2,max:17.77},"532":{comment:12377,min:2,max:17.772},"533":{comment:12377,min:2,max:17.772},"534":{comment:12377,min:2,max:17.772},"600":{comment:9490,min:2,max:13.3},"601":{comment:9490,min:2,max:13.3},"602":{comment:9512,min:2,max:13.73},"603":{comment:11695,min:2,max:13.325},"605":{comment:12964,min:2,max:14.325},"608":{comment:1060,min:2,max:11.887},"620":{comment:11981,min:1.65,max:16.5},"621":{comment:11981,min:1.65,max:16.5},"622":{comment:5019,min:2,max:15.76},"623":{comment:5050,min:1.6,max:15.76},"633":{comment:412,min:2,max:6},"634":{comment:412,min:2,max:6},"651":{comment:6543,min:2,max:13.325},"652":{comment:6543,min:2,max:13.32},"661":{comment:12354,min:2,max:17.759},"662":{comment:5074,min:2,max:14.802},"663":{comment:1507,min:2,max:10.23},"664":{comment:7250,min:2,max:15.22},"665":{comment:7250,min:2,max:15.22},"667":{comment:12278,min:2,max:17.922},"668":{comment:16858,min:2,max:18.165},"669":{comment:16858,min:2,max:18.17},"670":{comment:16856,min:2,max:18.165},"671":{comment:12863,min:2,max:16.45},"672":{comment:13046,min:2,max:16.45},"703":{comment:12931,min:2,max:14.88},"705":{comment:12931,min:2,max:14.88},"725":{comment:1080,min:0.914,max:11.887},"751":{comment:12834,min:2,max:15.1},"752":{comment:12834,min:2,max:15.1},"753":{comment:12834,min:2,max:15.1},"754":{comment:12834,min:2,max:15.1},"755":{comment:12834,min:2,max:15.1},"756":{comment:12962,min:2,max:15.1},"757":{comment:10989,min:2,max:17.8},"761":{comment:20546,min:2,max:14.2},"762":{comment:20546,min:2,max:18.798},"820":{comment:16656,min:1.6,max:18.48},"821":{comment:16656,min:1.6,max:18.48},"822":{comment:16856,min:1.6,max:18.48},"831":{comment:11297,min:2,max:18.41},"832":{comment:11297,min:2,max:18.409},"833":{comment:7279,min:3.25,max:18.012},"834":{comment:7279,min:3.25,max:18.012},"835":{comment:7305,min:2,max:15.226},"836":{comment:7305,min:2,max:15.226},"900":{comment:2644,min:1.6,max:11.9},"901":{comment:2692,min:2,max:12.02},"760":{comment:20546,min:2,max:18.798},"702":{comment:12931,min:2,max:16.15},"758":{comment:20546,min:2,max:14.5},"759":{comment:20546,min:2,max:14.5}};
const products={"PBCR":["LSFO","EGO 10PPM","EGO 500PPM","RHN","PCNA","NMOGAS","OLMOGAS","ATK","ARDR","IC5","ISOM","SLOP"],"WASHERY":["MOGAS 98","MOGAS 95","MOGAS 91","GO","KERO","ATK","Slop"],"PLCR":["Heavy Oil","Light Product","Mixed Product","Refined Oil","Final Product","Blended Oil"]};
window.addEventListener('load',()=>setTimeout(checkLogin,100));
function checkLogin(){const s=sessionStorage.getItem('tanktools_session'),u=localStorage.getItem('tanktools_current_user');if(s!=='active'||!u){showAccess();return}try{currentUser=JSON.parse(u);if(!currentUser||!currentUser.username){showAccess();return}initApp()}catch{showAccess()}}
function showAccess(){document.getElementById('mainContent').style.display='none';document.getElementById('accessDenied').style.display='flex'}
window.goToLogin=()=>{sessionStorage.setItem('tanktools_redirect','index.html');window.location.href='login.html'};
function initApp(){document.getElementById('mainContent').style.display='block';document.getElementById('accessDenied').style.display='none';loadUser();loadData();setupDark();loadFontSize()}
function loadUser(){if(!currentUser)return;document.getElementById('userName').textContent=currentUser.username;document.getElementById('userAvatar').textContent=(currentUser.fullName||currentUser.username).charAt(0).toUpperCase();if(currentUser.username==='fam030'||currentUser.role==='admin')document.getElementById('adminLink').style.display='inline-block';const roles=["admin","panel_operator","supervisor","section_head","operator","planning"];if(roles.includes(currentUser.role))document.getElementById('liveTanksLink').style.display='inline-block'}
window.logout=()=>{sessionStorage.removeItem('tanktools_session');localStorage.removeItem('tanktools_current_user');window.location.href='login.html'};
window.loadTank=()=>{const id=document.getElementById("tankInput").value.trim();if(tanks[id]){c=tanks[id].comment;m=tanks[id].min;x=tanks[id].max}else{c=m=x=0}calculate()};
window.calculate=()=>{const level=parseFloat(document.getElementById("level").value)||0,target=parseFloat(document.getElementById("target").value)||0,flowrate=parseFloat(document.getElementById("flowrate").value)||0,mode=document.getElementById("mode").value,flowUnit=document.getElementById("flowUnit").value;if(!c){document.getElementById("availablePumpable").textContent="";document.getElementById("currentUllage").textContent="";document.getElementById("valueDiff").textContent="";document.getElementById("levelEstimate").textContent="";document.getElementById("output").textContent="";return}const pumpable=Math.max(0,(level-m)*c),ullage=Math.max(0,(x-level)*c);document.getElementById("availablePumpable").textContent=`Available Pumpable: ${pumpable.toFixed(0)} bbl`;document.getElementById("currentUllage").textContent=`Current Ullage: ${ullage.toFixed(0)} bbl`;if(target>0){let diff=0,newLevel=0;if(mode==="pumpable"){diff=target-pumpable;newLevel=level-(diff/c)}else if(mode==="ullage"){diff=target-ullage;newLevel=level+(diff/c)}else if(mode==="level"){diff=target-level;newLevel=target}document.getElementById("valueDiff").textContent=`Difference: ${Math.abs(diff).toFixed(2)} ${mode==="level"?"m":"bbl"} ${diff>0?"needed":"excess"}`;document.getElementById("levelEstimate").textContent=`Target Level: ${newLevel.toFixed(3)} m`;if(flowrate>0&&mode!=="level"){let flowBbl=flowrate;if(flowUnit==="m3")flowBbl=flowrate*6.29;else if(flowUnit==="mtr")flowBbl=flowrate*c;const hours=Math.abs(diff)/flowBbl,finishTime=new Date(Date.now()+hours*3600000);document.getElementById("output").textContent=`Time needed: ${hours.toFixed(2)} hours | Finish: ${finishTime.toLocaleDateString()} ${finishTime.toLocaleTimeString()}`;calcData={tankNumber:document.getElementById("tankInput").value,finishDate:finishTime.toLocaleDateString(),finishTime:finishTime.toLocaleTimeString(),level:newLevel.toFixed(3),mode:mode,target:target,flowrate:flowrate,flowUnit:flowUnit};updateCalendarLink()}else{document.getElementById("output").textContent="";calcData=null}}else{document.getElementById("valueDiff").textContent="";document.getElementById("levelEstimate").textContent="";document.getElementById("output").textContent="";calcData=null}};
function updateCalendarLink(){if(!calcData)return;const title=`Tank ${calcData.tankNumber} - ${calcData.mode} ${calcData.target}`,details=`Tank: ${calcData.tankNumber}%0ATarget: ${calcData.target} ${calcData.mode}%0ALevel: ${calcData.level}m%0AFlowrate: ${calcData.flowrate} ${calcData.flowUnit}`,startDate=new Date(calcData.finishDate+" "+calcData.finishTime),endDate=new Date(startDate.getTime()+30*60000),formatDate=d=>d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z',url=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${formatDate(startDate)}/${formatDate(endDate)}&details=${details}`;document.getElementById("calendarLink").href=url}
window.addToTable=()=>{if(!calcData){alert("Please calculate first!");return}const table=document.getElementById("tankTable").getElementsByTagName('tbody')[0],row=table.insertRow(),cells=[calcData.tankNumber,calcData.finishDate,calcData.finishTime,'<button onclick="deleteRow(this)" style="background:red;color:white;border:none;padding:5px;border-radius:3px;cursor:pointer">Delete</button>'];cells.forEach((cell,i)=>{const td=row.insertCell(i);td.innerHTML=cell});saveTableData()};
function deleteRow(btn){btn.closest('tr').remove();saveTableData()}
function saveTableData(){const table=document.getElementById("tankTable").getElementsByTagName('tbody')[0],data=[];for(let row of table.rows){data.push({tank:row.cells[0].textContent,date:row.cells[1].textContent,time:row.cells[2].textContent})}localStorage.setItem('tanktools_table_data',JSON.stringify(data))}
function loadData(){const data=JSON.parse(localStorage.getItem('tanktools_table_data')||'[]'),table=document.getElementById("tankTable").getElementsByTagName('tbody')[0];data.forEach(item=>{const row=table.insertRow(),cells=[item.tank,item.date,item.time,'<button onclick="deleteRow(this)" style="background:red;color:white;border:none;padding:5px;border-radius:3px;cursor:pointer">Delete</button>'];cells.forEach((cell,i)=>{const td=row.insertCell(i);td.innerHTML=cell})})}
function setupDark(){const btn=document.getElementById("darkModeButton");btn.addEventListener("click",()=>{document.body.style.filter=document.body.style.filter?"":"invert(1) hue-rotate(180deg)";btn.textContent=document.body.style.filter?"‚òÄÔ∏è":"üåô"})}
window.openLTModal=()=>{if(!calcData){alert("Please calculate first!");return}document.getElementById("ltTank").value=calcData.tankNumber;document.getElementById("ltDate").value=calcData.finishDate;document.getElementById("ltTime").value=calcData.finishTime;document.getElementById("ltModal").classList.add("show")};
window.closeLTModal=()=>document.getElementById("ltModal").classList.remove("show");
window.updateLTProducts=()=>{const dept=document.getElementById("ltDept").value,productSelect=document.getElementById("ltProduct");productSelect.innerHTML='<option value="">Select Product</option>';if(products[dept]){products[dept].forEach(product=>{const option=document.createElement("option");option.value=product;option.textContent=product;productSelect.appendChild(option)})}};
document.getElementById("ltForm").addEventListener("submit",async e=>{e.preventDefault();const data={department:document.getElementById("ltDept").value,tankNumber:document.getElementById("ltTank").value,product:document.getElementById("ltProduct").value,finishDate:document.getElementById("ltDate").value,finishTime:document.getElementById("ltTime").value,notes:document.getElementById("ltNotes").value,addedBy:currentUser.username,addedAt:serverTimestamp()};try{await addDoc(collection(db,"liveTanks"),data);alert("Tank added to Live Tanks successfully!");closeLTModal();document.getElementById("ltForm").reset()}catch(error){console.error("Error:",error);alert("Error adding tank. Please try again.")}});
window.showLiveTanksHelp=()=>alert("Live Tanks Feature:\n\nAdds your tank to the live monitoring system. All users can see when your tank will finish. Useful for coordination between shifts and departments.\n\nThis helps everyone stay informed about tank schedules and plan accordingly.");
window.showCalendarHelp=()=>{const userAgent=navigator.userAgent.toLowerCase(),isAndroid=/android/.test(userAgent),isIOS=/iphone|ipad|ipod/.test(userAgent),isWindows=/windows/.test(userAgent),isMac=/macintosh|mac os x/.test(userAgent);let message="How to use Calendar Reminder:\n\n";message+="1. Calculate your tank finish time first\n";message+="2. Click 'Add Reminder' button\n";message+="3. It will open Google Calendar with your tank details\n\n";message+="To get Google Calendar:\n";if(isAndroid){message+="üì± Android: Install Google Calendar from Play Store";if(confirm(message+"\n\nWould you like to download Google Calendar now?")){window.open("https://play.google.com/store/apps/details?id=com.google.android.calendar","_blank")}}else if(isIOS){message+="üçé iPhone/iPad: Install Google Calendar from App Store";if(confirm(message+"\n\nWould you like to download Google Calendar now?")){window.open("https://apps.apple.com/app/google-calendar/id909319292","_blank")}}else if(isWindows){message+="ü™ü Windows: Use Google Calendar on web browser";if(confirm(message+"\n\nWould you like to open Google Calendar now?")){window.open("https://calendar.google.com","_blank")}}else if(isMac){message+="üçé Mac: Install Google Calendar from Mac App Store or use web";if(confirm(message+"\n\nWould you like to open Google Calendar now?")){window.open("https://calendar.google.com","_blank")}}else{message+="üåê Use Google Calendar in your web browser";if(confirm(message+"\n\nWould you like to open Google Calendar now?")){window.open("https://calendar.google.com","_blank")}}};
window.showTableHelp=()=>alert("Personal Table Feature:\n\nAdds tank to your personal table below. Only you can see this table - it's private to your account. Useful for tracking your own tanks during the shift.\n\nThis helps you keep track of multiple tanks you're working on without sharing with others.");
function loadFontSize(){const savedSize=localStorage.getItem('tanktools_font_size_index');if(savedSize){applyFontSize(parseInt(savedSize))}}
function applyFontSize(size){const elements=document.querySelectorAll('input, select, .result, h2, h3, label, button, .nav-link, .nav-logo, .nav-user, #tankTable, #tankTable th, #tankTable td');elements.forEach(el=>{el.style.fontSize=size+'px';if(el.tagName==='INPUT'||el.tagName==='SELECT'){el.style.padding=(size*0.6)+'px'}if(el.tagName==='BUTTON'){el.style.padding=(size*0.8)+'px '+(size*1.2)+'px'}})}
window.increaseFontSize=()=>{const current=parseInt(localStorage.getItem('tanktools_font_size_index'))||16;const newSize=Math.min(current+2,24);localStorage.setItem('tanktools_font_size_index',newSize);applyFontSize(newSize);alert(`Font size increased to ${newSize}px`)};
window.decreaseFontSize=()=>{const current=parseInt(localStorage.getItem('tanktools_font_size_index'))||16;const newSize=Math.max(current-2,12);localStorage.setItem('tanktools_font_size_index',newSize);applyFontSize(newSize);alert(`Font size decreased to ${newSize}px`)};
</script>
</body>
</html>

